<?xml version="1.0" encoding="UTF-8"?>
<!-- ====================================================================== 
     11.03.2009 20:59:56                                                        

     install-libs    
     description
                   
     jr                                                                
     ====================================================================== -->
<project name="maven-helper" default="usage" xmlns:artifact="uri:maven-artifact-ant">
	<description>
            description
    </description>

	<typedef resource="org/apache/maven/artifact/ant/antlib.xml" uri="uri:maven-artifact-ant" classpath="lib/maven-ant-tasks-2.0.9.jar" />

	<target name="usage">
		<echo>install-libs : installs required libs in local repository</echo>
		<echo>make-package : makes a package in folder target/assembly which is fit for redistribution</echo>
	</target>
		
	<target name="install-libs" description="description">
		<artifact:install file="../openscada_opc_dcom/lib/j-interop.jar">
			<artifact:pom file="../openscada_opc_dcom/lib/j-interop.pom" />
		</artifact:install>
		<artifact:install file="../openscada_opc_dcom/lib/j-interopdeps.jar">
			<artifact:pom file="../openscada_opc_dcom/lib/j-interopdeps.pom" />
		</artifact:install>
		<artifact:install file="../openscada_opc_dcom/lib/jcifs-1.2.9.jar">
			<artifact:pom file="../openscada_opc_dcom/lib/jcifs-1.2.9.pom" />
		</artifact:install>
	</target>

	<macrodef name="make-single-package">
		<attribute name="groupid" default="org.openscada.utgard" />
		<attribute name="artifactid" />
		<attribute name="module" />
		<sequential>
			<!-- Make source package -->
			<mkdir dir="${basedir}/target/assembly/@{module}/src" />
			<fileset dir="${basedir}/../" id="module-sources">
				<include name="@{module}/**" />
				<exclude name="@{module}/target/**" />
				<exclude name="@{module}/bin/**" />
				<exclude name="@{module}/testbin/**" />
			</fileset>
			<zip destfile="${basedir}/target/assembly/@{module}/src/@{module}-project.zip">
				<fileset refid="module-sources" />
			</zip>
			<!-- Make distrib package -->
			<mkdir dir="${basedir}/target/assembly/@{module}/dist" />
			<fileset dir="${basedir}/../@{module}" id="module-jars">
				<include name="target/*.jar" />
			</fileset>
			<copy todir="${basedir}/target/assembly/@{module}/dist" flatten="true">
				<fileset refid="module-jars" />
			</copy>
			<!-- Make dependencies package -->
			<artifact:pom id="@{module}.pom.file" file="${basedir}/../@{module}/pom.xml" />
			<mkdir dir="${basedir}/target/assembly/@{module}/lib" />
			<artifact:dependencies pathId="@{module}.runtime.classpath" filesetId="@{module}.runtime.fileset" useScope="runtime" pomRefId="@{module}.pom.file">
			</artifact:dependencies>
			<copy todir="${basedir}/target/assembly/@{module}/lib" flatten="true">
				<fileset refid="@{module}.runtime.fileset" />
			</copy>
			<delete>
				<fileset dir="${basedir}/target/assembly/@{module}/lib" includes="org.openscada.*.jar" />
			</delete>
			<!-- Make api doc folder -->
			<mkdir dir="${basedir}/target/assembly/@{module}/api" />
			<fileset dir="${basedir}/../@{module}/target/apidocs" id="module-api-doc">
			</fileset>
			<copy todir="${basedir}/target/assembly/@{module}/api" failonerror="false">
				<fileset refid="module-api-doc" />
			</copy>
		</sequential>
	</macrodef>

	<target name="make-package" description="create complete package">
		<delete dir="target/assembly">
		</delete>
		<make-single-package artifactid="org.openscada.utgard" module="openscada_opc_build" />
		<make-single-package artifactid="org.openscada.utgard.opc.dcom" module="openscada_opc_dcom" />
		<make-single-package artifactid="org.openscada.utgard.opc.lib" module="openscada_opc_lib" />
	</target>
</project>
